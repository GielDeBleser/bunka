#!/usr/bin/env ruby
require 'bunka'
require 'rubygems'
require 'thor'

class BunkaCommand < Thor
  map '-t' => :test

  desc 'test QUERY COMMAND', 'Execute command on nodes, scoped on the given query. Query syntax should be the same as `knife search` syntax.'
  option :invert, type: :boolean, desc: 'invert matched results', default: false
  option :timeout, type: :numeric, desc: 'timeout interval per ssh connection (default: 15)', default: 15
  option :'print-success', type: :boolean, desc: 'prints output of successful commands', default: false
  def test(query, command)
    Bunka.test(query, command, options[:timeout], options[:'print-success'], options[:invert])
  end
end

BunkaCommand.start
